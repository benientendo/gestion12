â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âœ… SOLUTION FINALE - Synchronisation Articles MAUI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ PROBLÃˆME RÃ‰SOLU

L'API retournait une erreur 400 car MAUI n'envoyait pas le boutique_id.

âœ… SOLUTION ADAPTÃ‰E

L'API accepte maintenant le numÃ©ro de sÃ©rie dans les HEADERS HTTP !
â†’ Pas besoin de changer les URLs
â†’ Juste ajouter un header Ã  chaque requÃªte

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¡ ENDPOINTS (InchangÃ©s)

Articles : GET /api/v2/simple/articles/
CatÃ©gories : GET /api/v2/simple/categories/

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”‘ HEADER Ã€ AJOUTER

Nom du header : X-Device-Serial
Valeur : Le numÃ©ro de sÃ©rie du terminal Android

Exemple :
X-Device-Serial: 0a1badae951f8473

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’» CODE C# POUR MAUI

Option 1 : Ajouter le header Ã  chaque requÃªte
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

public class ArticleService
{
    private readonly HttpClient _httpClient;
    private readonly string _baseUrl = "http://192.168.52.224:8000";
    private string _numeroSerie;

    public ArticleService(HttpClient httpClient)
    {
        _httpClient = httpClient;
        
        // RÃ©cupÃ©rer le numÃ©ro de sÃ©rie du terminal
        #if ANDROID
        _numeroSerie = Android.OS.Build.Serial ?? Android.OS.Build.GetSerial();
        #else
        _numeroSerie = "DEMO_SERIAL";
        #endif
    }

    public async Task<List<Article>> GetArticlesAsync()
    {
        try
        {
            var url = $"{_baseUrl}/api/v2/simple/articles/";
            
            // CrÃ©er la requÃªte avec le header
            var request = new HttpRequestMessage(HttpMethod.Get, url);
            request.Headers.Add("X-Device-Serial", _numeroSerie);
            
            var response = await _httpClient.SendAsync(request);
            
            if (response.IsSuccessStatusCode)
            {
                var content = await response.Content.ReadAsStringAsync();
                var result = JsonSerializer.Deserialize<ArticlesResponse>(content);
                
                Console.WriteLine($"âœ… {result.Count} articles rÃ©cupÃ©rÃ©s");
                return result.Articles;
            }
            
            Console.WriteLine($"âŒ Erreur: {response.StatusCode}");
            return new List<Article>();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"âŒ Exception: {ex.Message}");
            return new List<Article>();
        }
    }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Option 2 : Configurer le HttpClient globalement (RECOMMANDÃ‰)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Dans MauiProgram.cs ou au dÃ©marrage de l'app :

public static MauiApp CreateMauiApp()
{
    var builder = MauiApp.CreateBuilder();
    
    // RÃ©cupÃ©rer le numÃ©ro de sÃ©rie
    string numeroSerie = "";
    #if ANDROID
    numeroSerie = Android.OS.Build.Serial ?? Android.OS.Build.GetSerial();
    #endif
    
    // Configurer HttpClient avec le header par dÃ©faut
    builder.Services.AddHttpClient("DjangoAPI", client =>
    {
        client.BaseAddress = new Uri("http://192.168.52.224:8000");
        client.DefaultRequestHeaders.Add("X-Device-Serial", numeroSerie);
    });
    
    return builder.Build();
}

Puis dans vos services :

public class ArticleService
{
    private readonly HttpClient _httpClient;

    public ArticleService(IHttpClientFactory httpClientFactory)
    {
        _httpClient = httpClientFactory.CreateClient("DjangoAPI");
    }

    public async Task<List<Article>> GetArticlesAsync()
    {
        // Le header est automatiquement ajoutÃ© !
        var response = await _httpClient.GetAsync("/api/v2/simple/articles/");
        
        if (response.IsSuccessStatusCode)
        {
            var content = await response.Content.ReadAsStringAsync();
            var result = JsonSerializer.Deserialize<ArticlesResponse>(content);
            return result.Articles;
        }
        
        return new List<Article>();
    }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” VÃ‰RIFICATION

Dans les logs Django, vous devriez voir :

ğŸ” Tentative de rÃ©cupÃ©ration articles via numÃ©ro de sÃ©rie: 0a1badae951f8473
âœ… Terminal trouvÃ©: Terminal messie vanza â†’ Boutique ID: 2

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… AVANTAGES

1. Pas besoin de changer les URLs dans MAUI
2. Isolation automatique par boutique
3. SÃ©curisÃ© : chaque terminal ne voit que ses articles
4. Simple : juste un header Ã  ajouter

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ CHECKLIST

[ ] RÃ©cupÃ©rer le numÃ©ro de sÃ©rie du terminal Android
[ ] Ajouter le header X-Device-Serial Ã  toutes les requÃªtes API
[ ] Tester avec /api/v2/simple/articles/
[ ] Tester avec /api/v2/simple/categories/
[ ] VÃ©rifier que les articles s'affichent dans MAUI
[ ] VÃ©rifier les logs Django pour confirmer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ†˜ DÃ‰PANNAGE

ProblÃ¨me : Toujours erreur 400
â†’ VÃ©rifier que le header est bien envoyÃ©
â†’ VÃ©rifier le nom exact : X-Device-Serial (avec le tiret)

ProblÃ¨me : "Terminal non trouvÃ©"
â†’ VÃ©rifier que le numÃ©ro de sÃ©rie est correct
â†’ VÃ©rifier que le terminal existe dans Django
â†’ VÃ©rifier que le terminal est actif (est_actif=True)

ProblÃ¨me : "Terminal non associÃ© Ã  une boutique"
â†’ Dans Django, associer le terminal Ã  une boutique

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ SUPPORT

Si problÃ¨me, envoyer :
1. Le numÃ©ro de sÃ©rie du terminal
2. Les logs Django (console serveur)
3. Les logs MAUI (console app)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
